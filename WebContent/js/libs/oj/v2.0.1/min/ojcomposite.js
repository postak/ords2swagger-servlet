/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","knockout","ojs/ojknockout"],function(b,f){function a(a,c){function d(a,b,c){h(c,b,a)||a.readOnly||(a=e(c,a.type),m(b,a))}function e(a,b){switch(b.toLowerCase()){case "boolean":return Boolean(a);case "number":return Number(a);case "string":return a;default:return JSON.parse(a)}}function g(a){return a.toLowerCase().replace(/-(.)/g,function(a,b){return b.toUpperCase()})}function h(d,e,g){d=b.Sr.Z2(d);delete H[e];var l=n[e];l&&(l.dispose(),delete n[e]);if(l=r[e])a.removeEventListener(e+
Q,l),delete r[e];var w,l=g.readOnly;l||(w=function(){var a=p[e];a&&(a.dispose(),delete p[e])},w());var u=d.expr;if(u){var v=b.ia.uA(u);l||f.ignoreDependencies(function(){n[e]=f.computed(function(){w();if(!H[e]){var a=v(c);f.isObservable(a)?p[e]=k(e,a):m(e,a)}})});r[e]=q(e,u,v,g.writeback&&!d.Una);return!0}return!1}function k(a,b){f.ignoreDependencies(function(){m(a,f.utils.unwrapObservable(b))});return b.subscribe(function(b){H[a]||m(a,b)})}function q(d,e,g,h){function k(a){var q=!1;P||(h&&f.ignoreDependencies(function(){var d=
a.detail.value,h=g(c);f.isWriteableObservable(h)?(q=!0,h(d)):(h=b.Sr.l3(e),null!=h&&(b.ia.uA(h)(c)(d),q=!0))}),q||(H[d]=!0))}a.addEventListener(d+Q,k);return k}function l(a){return a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})}function m(b,c){P=!0;try{a[b]=c}finally{P=!1}}this.Rj=function(b){var c=b.properties;if(c){s.setAttribute=a.setAttribute;s.removeAttribute=a.removeAttribute;a.setAttribute=function(a,b){e(a,b,s.setAttribute)};a.removeAttribute=function(a){e(a,null,s.removeAttribute)};
var e=function(b,e,f){b=b.toLowerCase();var h=a.getAttribute(b);f.apply(a,arguments);var k=a.getAttribute(b),q=g(b);a.hasOwnProperty(q)&&k!==h&&d(c[q],q,k)};b=Object.keys(c);C=!0;try{b.forEach(function(b){var e=l(b),f=c[b];a.hasAttribute(e)?(e=a.getAttribute(e),d(f,b,e)):f.readOnly||(a[b]=f.value)})}finally{C=!1}}return this};this.lpa=function(){return C};this.Bqa=function(a){var b;[p,n].forEach(function(a){b=Object.keys(a);for(a=0;a<b.length;a++)n[b[a]].dispose()});p={};n={};b=Object.keys(s);var c;
for(c=0;c<b.length;c++){var d=b[c];a[d]=s[d]}s={};b=Object.keys(r);for(c=0;c<b.length;c++)d=b[c],a.removeEventListener(d+Q,r[d]);r={}};var n={},p={},r={},s={},H={},C,P,Q="-changed"}function d(a,c){switch(c){case "view":return b.we.Gb.viewPath+a+b.we.Gb.viewSuffix;case "viewModel":return b.we.Gb.modelPath+a;case "metadata":return b.we.Gb.metadataPath+a+b.we.Gb.metadataSuffix;case "css":return b.we.Gb.cssPath+a}}function c(a,c){var e=null,f=a[c];if(null!=f){e=Object.keys(f)[0];f=f[e];if(null==e)throw"Invalid component descriptor key";
switch(e){case "inline":e=Promise.resolve(f);break;case "promise":e=f;break;case "require":var g=d(f,c),e=new Promise(function(a){require([g],function(b){a("metadata"===c?JSON.parse(b):b)},function(a){var c="ojComposite failed to load "+g;a&&"string"===typeof a&&(c=c+" due to: "+a);b.r.error(c);a instanceof Error&&b.r.error(a.stack)})});break;default:throw"Invalid descriptor key "+e+" for the resopurce type: "+c;}}return e}function e(a,c,d){if(null!=a&&(c=b.we.Gb[c],null!=c&&a&&(c=a[c],"function"===
typeof c)))return f.ignoreDependencies(c,a,d)}function g(a,b,c,d){m(c,"properties",function(c,e){k(a,b,c,e,d)})}function h(a,b,c){m(b,"methods",function(d){var e=b.methods[d].internalName;a[d]=e?c[e].bind(c):c[d].bind(c)})}function k(a,b,c,d,e){function g(b){var d=h.peek();d!==b&&(h(b),e.lpa()||(b=new CustomEvent(c+"-changed",{detail:{value:b,previousValue:d}}),a.dispatchEvent(b)))}var h=f.observable();l(b,c,function(){return h()},g);l(a,c,function(){return h.peek()},function(a){if(d.readOnly)throw"Read-only property "+
c+" cannot be set";g(a)})}function l(a,b,c,d){Object.defineProperty(a,b,{configurable:!0,enumerable:!0,get:c,set:d})}function m(a,b,c){if(a){var d=a[b]||{};Object.keys(d).forEach(function(a){c(a,d[a])})}}function n(a,b){["methods","properties"].forEach(function(c){m(b,c,function(b){delete a[b]})})}function p(a){var b={};a=a.childNodes;for(var c=0;c<a.length;c++){var d=a[c];if((1===d.nodeType||3===d.nodeType)&&(3!==d.nodeType||d.nodeValue.trim())){var e=d.__oj_slots;(e=null!=e?e:d.getAttribute&&d.getAttribute("slot"))||
(e="");b[e]||(b[e]=[]);b[e].push(d)}}return b}function r(a,b){var c,d=a.childNodes;if(d){c=document.createElement("div");c.setAttribute("data-bind","_ojNodeStorage_");c.style.display="none";b.push(c);for(var e=[],f=0;f<d.length;f++){var g=d[f];1!==g.nodeType&&3!==g.nodeType||e.push(g)}e.forEach(function(a){c.appendChild(a)})}return c}f.bindingHandlers._ojNodeStorage_={init:function(){return{controlsDescendantBindings:!0}}};f.bindingHandlers._ojSlot_={init:function(a,b,c,d,e){f.utils.domNodeDisposal.addDisposeCallback(a,
function(b){if(b=b.__oj_nodestorage)for(var c;c=f.virtualElements.firstChild(a);)null!=c.__oj_slots&&b.appendChild(c)}.bind(null,e));d=e.__oj_slots;b=b();c=f.utils.unwrapObservable;e=c(b.name)||"";var g=c(b.index);if(d=null!=g?[d[e][g]]:d[e]){for(e=0;e<d.length;e++)d[e].__oj_slots=c(b.slot)||"";f.virtualElements.setDomNodeChildren(a,d);return{controlsDescendantBindings:!0}}}};f.virtualElements.allowedBindings._ojSlot_=!0;(function(){b.OS.F1({nodeHasBindings:function(a,c){return c||1===a.nodeType&&
b.we.WG(a.nodeName.toLowerCase())},getBindingAccessors:function(a,c,d){if(1===a.nodeType&&(a=a.nodeName.toLowerCase(),b.we.WG(a))){d=d||{};if(d.ojComposite)throw"Cannot use ojComposite binding on a custom element whose name is already registered for a composite binding";var e={name:a};d.ojComposite=function(){return e}}return d},preprocessNode:function(a,c){var d;if(1===a.nodeType&&"oj-slot"===a.nodeName.toLowerCase()){d=["name","slot","index"];for(var e="ko _ojSlot_:{",f=[],g=0;g<d.length;g++){var h=
d[g],k;k=a.getAttribute(h);if(null!=k){var q=b.Sr.Z2(k).expr;null==q&&(q="'"+k+"'");k=q}else k=null;k&&f.push(h+":"+k)}e+=f.join(",");g=document.createComment(e+"}");e=document.createComment("/ko");d=[g];f=a.parentNode;for(f.insertBefore(g,a);0<a.childNodes.length;)g=a.childNodes[0],f.insertBefore(g,a),d.push(g);d.push(e);f.replaceChild(e,a)}return d?d:c}})})();b.we={};b.we.Gb={viewPath:"text!composite/views/",viewSuffix:".html",modelPath:"composite/viewModels/",metadataPath:"text!composite/metadata/",
metadataSuffix:".json",cssPath:"css!composite/css/",initializeMethod:"initialize",activatedMethod:"activated",attachedMethod:"attached",bindingsAppliedMethod:"bindingsApplied",disposeMethod:"dispose"};o_("Composite.defaults",b.we.Gb,b);b.we.register=function(a,c){b.we.h_[a]=c};o_("Composite.register",b.we.register,b);b.we.WG=function(a){return b.we.h_[a]};b.we.h_={};f.bindingHandlers.ojComposite={init:function(){return{controlsDescendantBindings:!0}},update:function(d,k,l,m,u){function y(a){D&&(D.Bqa(d),
D=null);A=a;e(G,"disposeMethod",[d]);G=null;z&&n(d,z);H&&(d.removeChild(H),H=null);z=null;F={}}function B(a){return function(b){if(A||b!=E)throw M;return a.apply(this,Array.prototype.slice.call(arguments,1))}.bind(null,E)}var M=Error(),G,D,E=-1,A=!1,z,F={},H,C=f.utils.unwrapObservable;f.ignoreDependencies(function(){f.computed(function(){E++;d.dispatchEvent(new CustomEvent("pending",{bubbles:!0}));y(!1);var l=C(k())||{},l=C(l.name),m=b.we.WG(l);if(!m)throw"Composite is missing a descriptor";var n=
c(m,"metadata"),l=null;n&&(l=n.then(B(function(c){c?(z=c,D=new a(d,u),g(d,F,c,D),D.Rj(c)):b.r.Hsa("ojComposite is being loaded without metadata. No element properties will be set up");return F})));var w,n=new Promise(function(a){w=a}),v=q+s++,N={element:d,props:l,slotNodeCounts:n,unique:v},n=null,O=c(m,"viewModel");O&&(n=O.then(B(function(a){return a="function"===typeof a?new a(N):e(a,"initializeMethod",[N])||a})));O=null;n&&(O=n.then(B(function(a){return e(a,"activatedMethod",[N])})));var T=c(m,
"view");T&&(T=T.then(B(function(a){if("string"===typeof a)a=f.utils.parseHtmlFragment(a);else if(window.DocumentFragment?a instanceof DocumentFragment:a&&11===a.nodeType)a=f.utils.arrayPushAll([],a.childNodes);else if(Array.isArray(a))a=f.utils.arrayPushAll([],a);else throw"The View ("+a+") has an unsupported type";return a})));(m=c(m,"css"))&&(m=m.then(B(function(a){if(a){var b=document.createElement("style");b.type="text/css";b.styleSheet?b.styleSheet.cssText=a:b.appendChild(document.createTextNode(a));
document.head.appendChild(b)}})));f.applyBindingsToDescendants(u,d);Promise.all([T,n,l,m,O]).then(function(a,b){if(!A&&a==E){var c=b[0];if(!c)throw"ojComposite is missing a View";var g=p(d),k={},q;for(q in g)k[q]=g[q].length;w(k);H=r(d,c);f.virtualElements.setDomNodeChildren(d,c);G=b[1];e(G,"attachedMethod",[N]);c=u.createChildContext(G,void 0,function(a){a.__oj_slots=g;a.__oj_nodestorage=H;a.$slotNodeCounts=k;a.$props=F;a.$unique=v});z&&G&&h(d,z,G);f.applyBindingsToDescendants(c,d);e(G,"bindingsAppliedMethod",
[N]);d.dispatchEvent(new CustomEvent("ready",{bubbles:!0}))}}.bind(null,E),function(a,c){c!==M&&null!=c&&b.r.error(c)}.bind(null,E))},null,{disposeWhenNodeIsRemoved:d})});f.utils.domNodeDisposal.addDisposeCallback(d,y.bind(null,!0,u))}};var s=0,q="_ojcomposite"});